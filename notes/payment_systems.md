---
layout: page
title: Payment Systems
permalink: /payment-systems/
---

# Payment Systems

## Description

A payment system can mean different things to different people. To some, it
could mean a [Digital
Wallet](https://www.investopedia.com/terms/d/digital-wallet.asp), like Venmo or
Apple Pay. Others may think of a backend system that executes payments like
Stripe or Paypal. Consequently, this classification is a loose descriptor
that only coveys the general nature of the problem; specific requirements are
necessary to get a clear picture of system responsibilities.

A common thread among payment systems is **money movement** â€“ the need to
facilitate the transfer of funds between at least two parties.

### Idempotency

Idempotent operations is a primary concern when designing payment systems. It's
imperative to guarantee that a customer won't be charged more than once,
irrespective of external factors like network errors or service provider
downtime. Operations should be repeated/retried as necessary, producing the same
result without any effects on the system. This implies **exactly-once
delivery:** each payment must be executed _at least_ once, and can be executed
_at most_ once.

#### Retry Strategies

The at-least once guarantee can be met with **retries**. A retry strategy should
consider the length of time to wait before retrying, and when the request should
be canceled with no further attempts. See [[client-retry-strategies]] for
example strategies.

#### Idempotency Key

The at-most guarantee can bet met with **idempotency key usage**. For web/mobile client-server communication,
[UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier) is commonly
used in request headers as an idempotency key (`<idempotency-key: key_value>`);
this is recommended by Stripe and Paypal. Alternatively, e-commerce websites
commonly use the id of shopping carts right before checkout.

- Reliability / Fault Tolerance
- Handling Payment Failures
- Handling Payment Processing Delays

- Security
- Reconciliation
- Executing Payments (PSP Integration)


### Industry Examples:
- [Uber](https://www.youtube.com/watch?v=5TD8m7w1xE0)
- [Shopify](https://help.shopify.com/en/manual/payments/shopify-payments)
- [Stripe](https://stripe.com/docs/api)


[//begin]: # "Autogenerated link references for markdown compatibility"
[client-retry-strategies]: client-retry-strategies "Client Retry Strategies"
[//end]: # "Autogenerated link references"